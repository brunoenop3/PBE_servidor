<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Prueba del Backend Escolar</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px; }
    .tarjeta { border: 1px solid #ccc; padding: 10px; margin: 5px 0; border-radius: 6px; background: #fafafa; }
    .tarjeta div { margin: 4px 0; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h2>Prueba del Backend Escolar</h2>

  <!-- Sección inicial para ingresar UID -->
  <div id="uid-section">
    <label for="uid-input">Ingrese su UID:</label>
    <input type="text" id="uid-input" placeholder="Escribe tu UID" />
    <button id="btnSetUid">Aceptar UID</button>
  </div>

  <!-- Sección principal: aparece tras ingresar UID -->
  <div id="main-section" class="hidden">
    <p>UID: <span id="uid-display"></span></p>
    <p>BIENVENIDO! <span name = "name-display"></span></p>
    <button id="btnTimetables">Cargar Horarios</button>
    <button id="btnTasks">Cargar Tareas</button>
    <button id="btnMarks">Cargar Notas</button>
    <div id="contenedor"></div>
   

  </div>

  <script>
    const uidSection = document.getElementById('uid-section');
    const mainSection = document.getElementById('main-section');
    const uidInput = document.getElementById('uid-input');
    const uidDisplay = document.getElementById('uid-display');
    const contenedor = document.getElementById('contenedor');
    const estudiante = estudiantes.find(e => e.uid === uidIngresado);
    let currentUid = '';

    // Mostrar u ocultar secciones
    function showMain() {
      uidSection.classList.add('hidden');
      mainSection.classList.remove('hidden');
      uidDisplay.textContent = currentUid;
    }

    // Evento para confirmar UID
    document.getElementById('btnSetUid').addEventListener('click', () => {
      const uid = uidInput.value.trim();
      if (!uid) {
        alert('Por favor, escribe un UID.');
        return;
      }
      currentUid = uid;
      showMain();
    });

    function limpiar() {
      contenedor.innerHTML = '';
    }

    function crearTarjeta(input) {
      const tarjeta = document.createElement('div');
      tarjeta.className = 'tarjeta';

      if (typeof input === 'string') {
        tarjeta.textContent = input;
        contenedor.appendChild(tarjeta);
        return;
      }
      // elimina '_v, _id'
      for (const [key, val] of Object.entries(input)) {
        if (key === '_id' || key === '__v') continue;
        const linea = document.createElement('div');
        linea.innerHTML = `<strong>${key}:</strong> ${val}`;
        tarjeta.appendChild(linea);
      }

      contenedor.appendChild(tarjeta);
    }

    function fetchData(endpoint) {
      limpiar();
      fetch(`http://localhost:3000/${endpoint}`, {
        headers: { 'uid': currentUid }
      })
      .then(res => res.json())
      .then(data => {
        if (Array.isArray(data)) {
          data.forEach(item => crearTarjeta(item));
        } else {
          crearTarjeta('Respuesta no esperada.');
        }
      })
      .catch(err => {
        console.error(err);
        crearTarjeta('Error al conectar con el servidor.');
      });
    }

    document.getElementById('btnTimetables')
      .addEventListener('click', () => fetchData('timetables'));
    document.getElementById('btnTasks')
      .addEventListener('click', () => fetchData('tasks'));
    document.getElementById('btnMarks')
      .addEventListener('click', () => fetchData('marks'));
  </script>
</body>
</html>
